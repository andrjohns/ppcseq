separate(.variable, c(".variable", "S", "G"), sep="[\\[,\\]]") %>%
mutate(S = S %>% as.integer, G = G %>% as.integer) %>%
left_join(my_df) %>%
rowwise() %>%
mutate(`ppc` = `read count` %>% between(`2.5%`, `97.5%`)) %>%
filter(symbol=="DNAH3") %>%
{
(.) %>% ggplot(aes(y=`read count`, x=sample)) +
geom_errorbar(aes(ymin=`2.5%`, ymax=`97.5%`, type=ppc)) +
my_theme
}
fit %>%
summary("counts_rng") %$%
summary %>%
as_tibble(rownames = ".variable") %>%
separate(.variable, c(".variable", "S", "G"), sep="[\\[,\\]]") %>%
mutate(S = S %>% as.integer, G = G %>% as.integer) %>%
left_join(my_df) %>%
rowwise() %>%
mutate(`ppc` = `read count` %>% between(`2.5%`, `97.5%`)) %>%
filter(symbol=="DNAH3") %>%
{
(.) %>% ggplot(aes(y=`read count`, x=sample)) +
geom_errorbar(aes(ymin=`2.5%`, ymax=`97.5%`, linetype =ppc)) +
my_theme
}
fit %>%
summary("counts_rng") %$%
summary %>%
as_tibble(rownames = ".variable") %>%
separate(.variable, c(".variable", "S", "G"), sep="[\\[,\\]]") %>%
mutate(S = S %>% as.integer, G = G %>% as.integer) %>%
left_join(my_df) %>%
rowwise() %>%
mutate(`ppc` = `read count` %>% between(`2.5%`, `97.5%`)) %>%
filter(symbol=="DNAH3") %>%
{
(.) %>% ggplot(aes(y=`read count`, x=sample)) +
geom_errorbar(aes(ymin=`2.5%`, ymax=`97.5%`, linetype =ppc)) +
my_theme
} %>%
{
if(parse_formula(formula)[1] %>% is.null %>% `!`) (.) + geom_point(aes(color=parse_formula(formula)[1]))
(.) + geom_point()
}
fit %>%
summary("counts_rng") %$%
summary %>%
as_tibble(rownames = ".variable") %>%
separate(.variable, c(".variable", "S", "G"), sep="[\\[,\\]]") %>%
mutate(S = S %>% as.integer, G = G %>% as.integer) %>%
left_join(my_df) %>%
rowwise() %>%
mutate(`ppc` = `read count` %>% between(`2.5%`, `97.5%`)) %>%
filter(symbol=="DNAH3") %>%
{
(.) %>% ggplot(aes(y=`read count`, x=sample)) +
geom_errorbar(aes(ymin=`2.5%`, ymax=`97.5%`, alpha =ppc)) +
my_theme
} %>%
{
if(parse_formula(formula)[1] %>% is.null %>% `!`) (.) + geom_point(aes(color=parse_formula(formula)[1]))
(.) + geom_point()
}
fit %>%
summary("counts_rng") %$%
summary %>%
as_tibble(rownames = ".variable") %>%
separate(.variable, c(".variable", "S", "G"), sep="[\\[,\\]]") %>%
mutate(S = S %>% as.integer, G = G %>% as.integer) %>%
left_join(my_df) %>%
rowwise() %>%
mutate(`ppc` = `read count` %>% between(`2.5%`, `97.5%`)) %>%
filter(symbol=="DNAH3") %>%
{
(.) %>% ggplot(aes(y=`read count`, x=sample)) +
geom_errorbar(aes(ymin=`2.5%`, ymax=`97.5%`, color =ppc)) +
my_theme
} %>%
{
if(parse_formula(formula)[1] %>% is.null %>% `!`) (.) + geom_point(aes(color=parse_formula(formula)[1]))
(.) + geom_point(shape=1)
}
fit %>%
summary("counts_rng") %$%
summary %>%
as_tibble(rownames = ".variable") %>%
separate(.variable, c(".variable", "S", "G"), sep="[\\[,\\]]") %>%
mutate(S = S %>% as.integer, G = G %>% as.integer) %>%
left_join(my_df) %>%
rowwise() %>%
mutate(`ppc` = `read count` %>% between(`2.5%`, `97.5%`)) %>%
filter(symbol=="DNAH3") %>%
{
(.) %>% ggplot(aes(y=`read count`, x=sample)) +
geom_errorbar(aes(ymin=`2.5%`, ymax=`97.5%`, color =ppc)) +
my_theme
} %>%
{
if(parse_formula(formula)[1] %>% is.null %>% `!`) (.) + geom_point(aes(color=parse_formula(formula)[1]))
(.) + geom_point(shape=1, fill="red")
}
fit %>%
summary("counts_rng") %$%
summary %>%
as_tibble(rownames = ".variable") %>%
separate(.variable, c(".variable", "S", "G"), sep="[\\[,\\]]") %>%
mutate(S = S %>% as.integer, G = G %>% as.integer) %>%
left_join(my_df) %>%
rowwise() %>%
mutate(`ppc` = `read count` %>% between(`2.5%`, `97.5%`)) %>%
filter(symbol=="DNAH3") %>%
{
(.) %>% ggplot(aes(y=`read count`, x=sample)) +
geom_errorbar(aes(ymin=`2.5%`, ymax=`97.5%`, color =ppc)) +
my_theme
} %>%
{
if(parse_formula(formula)[1] %>% is.null %>% `!`) (.) + geom_point(aes(color=parse_formula(formula)[1]))
(.) + geom_point(shape=21, fill="red")
}
fit %>%
summary("counts_rng") %$%
summary %>%
as_tibble(rownames = ".variable") %>%
separate(.variable, c(".variable", "S", "G"), sep="[\\[,\\]]") %>%
mutate(S = S %>% as.integer, G = G %>% as.integer) %>%
left_join(my_df) %>%
rowwise() %>%
mutate(`ppc` = `read count` %>% between(`2.5%`, `97.5%`)) %>%
filter(symbol=="DNAH3") %>%
{
(.) %>% ggplot(aes(y=`read count`, x=sample)) +
geom_errorbar(aes(ymin=`2.5%`, ymax=`97.5%`, color =ppc)) +
my_theme
} %>%
{
if(parse_formula(formula)[1] %>% is.null %>% `!`) (.) + geom_point(aes(fill=parse_formula(formula)[1]))
(.) + geom_point(shape=21, fill="black")
}
fit %>%
summary("counts_rng") %$%
summary %>%
as_tibble(rownames = ".variable") %>%
separate(.variable, c(".variable", "S", "G"), sep="[\\[,\\]]") %>%
mutate(S = S %>% as.integer, G = G %>% as.integer) %>%
left_join(my_df) %>%
rowwise() %>%
mutate(`ppc` = `read count` %>% between(`2.5%`, `97.5%`)) %>%
group_by(sample, symbol) %>%
summarise(`ppc samples failed` = ppc %>% `!` %>% sum) %>%
ungroup %>%
distinct(sample, symbol, `ppc samples failed` )
fit %>%
summary("counts_rng") %$%
summary %>%
as_tibble(rownames = ".variable") %>%
separate(.variable, c(".variable", "S", "G"), sep="[\\[,\\]]") %>%
mutate(S = S %>% as.integer, G = G %>% as.integer) %>%
left_join(my_df) %>%
rowwise() %>%
mutate(`ppc` = `read count` %>% between(`2.5%`, `97.5%`)) %>%
group_by(sample, symbol) %>%
nest
?map2
fit %>%
summary("counts_rng") %$%
summary %>%
as_tibble(rownames = ".variable") %>%
separate(.variable, c(".variable", "S", "G"), sep="[\\[,\\]]") %>%
mutate(S = S %>% as.integer, G = G %>% as.integer) %>%
left_join(my_df) %>%
rowwise() %>%
mutate(`ppc` = `read count` %>% between(`2.5%`, `97.5%`)) %>%
group_by(sample, symbol) %>%
nest %>%
mutate(plot = map2(data, sample + symbol, ~
{
ggplot(data = .x, aes(y=`read count`, x=sample)) +
geom_errorbar(aes(ymin=`2.5%`, ymax=`97.5%`, color =ppc)) +
my_theme
} %>%
{
if(parse_formula(formula)[1] %>% is.null %>% `!`) (.) + geom_point(aes(fill=parse_formula(formula)[1]))
(.) + geom_point(shape=21, fill="black")
}
))
fit %>%
summary("counts_rng") %$%
summary %>%
as_tibble(rownames = ".variable") %>%
separate(.variable, c(".variable", "S", "G"), sep="[\\[,\\]]") %>%
mutate(S = S %>% as.integer, G = G %>% as.integer) %>%
left_join(my_df) %>%
rowwise() %>%
mutate(`ppc` = `read count` %>% between(`2.5%`, `97.5%`)) %>%
group_by(symbol) %>%
nest %>%
mutate(plot = map2(data, symbol, ~
{
ggplot(data = .x, aes(y=`read count`, x=sample)) +
geom_errorbar(aes(ymin=`2.5%`, ymax=`97.5%`, color =ppc)) +
my_theme
} %>%
{
if(parse_formula(formula)[1] %>% is.null %>% `!`) (.) + geom_point(aes(fill=parse_formula(formula)[1]))
(.) + geom_point(shape=21, fill="black")
}
))
fit %>%
summary("counts_rng") %$%
summary %>%
as_tibble(rownames = ".variable") %>%
separate(.variable, c(".variable", "S", "G"), sep="[\\[,\\]]") %>%
mutate(S = S %>% as.integer, G = G %>% as.integer) %>%
left_join(my_df) %>%
rowwise() %>%
mutate(`ppc` = `read count` %>% between(`2.5%`, `97.5%`)) %>%
group_by(symbol) %>%
nest %>%
mutate(plot = map2(data, symbol, ~
ggplot(data = .x, aes(y=`read count`, x=sample)) +
geom_errorbar(aes(ymin=`2.5%`, ymax=`97.5%`, color =ppc)) +
my_theme
))
fit %>%
summary("counts_rng") %$%
summary %>%
as_tibble(rownames = ".variable") %>%
separate(.variable, c(".variable", "S", "G"), sep="[\\[,\\]]") %>%
mutate(S = S %>% as.integer, G = G %>% as.integer) %>%
left_join(my_df) %>%
rowwise() %>%
mutate(`ppc` = `read count` %>% between(`2.5%`, `97.5%`)) %>%
group_by(symbol) %>%
nest %>%
mutate(plot = map2(data, symbol, ~
{
ggplot(data = .x, aes(y=`read count`, x=sample)) +
geom_errorbar(aes(ymin=`2.5%`, ymax=`97.5%`, color =ppc)) +
my_theme
} %>%
{
if(parse_formula(formula)[1] %>% is.null %>% `!`) (.) + geom_point(aes(fill=parse_formula(formula)[1]))
(.) + geom_point(shape=21, fill="black")
}
)) %>%
mutate(
`ppc samples failed` = map2(data, symbol, ~ .x %>% pull(ppc) %>% `!` %>% sum)
)
fit %>%
summary("counts_rng") %$%
summary %>%
as_tibble(rownames = ".variable") %>%
separate(.variable, c(".variable", "S", "G"), sep="[\\[,\\]]") %>%
mutate(S = S %>% as.integer, G = G %>% as.integer) %>%
left_join(my_df) %>%
rowwise() %>%
mutate(`ppc` = `read count` %>% between(`2.5%`, `97.5%`)) %>%
group_by(symbol) %>%
nest %>%
mutate(plot = map2(data, symbol, ~
{
ggplot(data = .x, aes(y=`read count`, x=sample)) +
geom_errorbar(aes(ymin=`2.5%`, ymax=`97.5%`, color =ppc)) +
my_theme
} %>%
{
if(parse_formula(formula)[1] %>% is.null %>% `!`) (.) + geom_point(aes(fill=parse_formula(formula)[1]))
(.) + geom_point(shape=21, fill="black")
}
)) %>%
mutate(
`ppc samples failed` = map_int(.x %>% pull(ppc) %>% `!` %>% sum)
)
fit %>%
summary("counts_rng") %$%
summary %>%
as_tibble(rownames = ".variable") %>%
separate(.variable, c(".variable", "S", "G"), sep="[\\[,\\]]") %>%
mutate(S = S %>% as.integer, G = G %>% as.integer) %>%
left_join(my_df) %>%
rowwise() %>%
mutate(`ppc` = `read count` %>% between(`2.5%`, `97.5%`)) %>%
group_by(symbol) %>%
nest %>%
mutate(plot = map2(data, symbol, ~
{
ggplot(data = .x, aes(y=`read count`, x=sample)) +
geom_errorbar(aes(ymin=`2.5%`, ymax=`97.5%`, color =ppc)) +
my_theme
} %>%
{
if(parse_formula(formula)[1] %>% is.null %>% `!`) (.) + geom_point(aes(fill=parse_formula(formula)[1]))
(.) + geom_point(shape=21, fill="black")
}
)) %>%
mutate(
`ppc samples failed` = map_int(. %>% pull(ppc) %>% `!` %>% sum)
)
fit %>%
summary("counts_rng") %$%
summary %>%
as_tibble(rownames = ".variable") %>%
separate(.variable, c(".variable", "S", "G"), sep="[\\[,\\]]") %>%
mutate(S = S %>% as.integer, G = G %>% as.integer) %>%
left_join(my_df) %>%
rowwise() %>%
mutate(`ppc` = `read count` %>% between(`2.5%`, `97.5%`)) %>%
group_by(symbol) %>%
nest %>%
mutate(plot = map2(data, symbol, ~
{
ggplot(data = .x, aes(y=`read count`, x=sample)) +
geom_errorbar(aes(ymin=`2.5%`, ymax=`97.5%`, color =ppc)) +
my_theme
} %>%
{
if(parse_formula(formula)[1] %>% is.null %>% `!`) (.) + geom_point(aes(fill=parse_formula(formula)[1]))
(.) + geom_point(shape=21, fill="black")
}
))
fit %>%
summary("counts_rng") %$%
summary %>%
as_tibble(rownames = ".variable") %>%
separate(.variable, c(".variable", "S", "G"), sep="[\\[,\\]]") %>%
mutate(S = S %>% as.integer, G = G %>% as.integer) %>%
left_join(my_df) %>%
rowwise() %>%
mutate(`ppc` = `read count` %>% between(`2.5%`, `97.5%`)) %>%
group_by(symbol) %>%
nest %>%
mutate(plot = map2(data, symbol, ~
{
ggplot(data = .x, aes(y=`read count`, x=sample)) +
geom_errorbar(aes(ymin=`2.5%`, ymax=`97.5%`, color =ppc)) +
my_theme
} %>%
{
if(parse_formula(formula)[1] %>% is.null %>% `!`) (.) + geom_point(aes(fill=parse_formula(formula)[1]))
(.) + geom_point(shape=21, fill="black")
}
)) %>%
mutate(
`ppc samples failed` = map_int(data %>% pull(ppc) %>% `!` %>% sum)
)
map_int
?map_int
fit %>%
summary("counts_rng") %$%
summary %>%
as_tibble(rownames = ".variable") %>%
separate(.variable, c(".variable", "S", "G"), sep="[\\[,\\]]") %>%
mutate(S = S %>% as.integer, G = G %>% as.integer) %>%
left_join(my_df) %>%
rowwise() %>%
mutate(`ppc` = `read count` %>% between(`2.5%`, `97.5%`)) %>%
group_by(symbol) %>%
nest %>%
mutate(plot = map2(data, symbol, ~
{
ggplot(data = .x, aes(y=`read count`, x=sample)) +
geom_errorbar(aes(ymin=`2.5%`, ymax=`97.5%`, color =ppc)) +
my_theme
} %>%
{
if(parse_formula(formula)[1] %>% is.null %>% `!`) (.) + geom_point(aes(fill=parse_formula(formula)[1]))
(.) + geom_point(shape=21, fill="black")
}
)) %>%
mutate(
`ppc samples failed` = map_int(data, ~ data %>% pull(ppc) %>% `!` %>% sum)
)
fit %>%
summary("counts_rng") %$%
summary %>%
as_tibble(rownames = ".variable") %>%
separate(.variable, c(".variable", "S", "G"), sep="[\\[,\\]]") %>%
mutate(S = S %>% as.integer, G = G %>% as.integer) %>%
left_join(my_df) %>%
rowwise() %>%
mutate(`ppc` = `read count` %>% between(`2.5%`, `97.5%`)) %>%
group_by(symbol) %>%
nest %>%
mutate(plot = map2(data, symbol, ~
{
ggplot(data = .x, aes(y=`read count`, x=sample)) +
geom_errorbar(aes(ymin=`2.5%`, ymax=`97.5%`, color =ppc)) +
my_theme
} %>%
{
if(parse_formula(formula)[1] %>% is.null %>% `!`) (.) + geom_point(aes(fill=parse_formula(formula)[1]))
(.) + geom_point(shape=21, fill="black")
}
)) %>%
mutate(
`ppc samples failed` = map_int(data, ~ .x %>% pull(ppc) %>% `!` %>% sum)
)
x = 	fit %>%
summary("counts_rng") %$%
summary %>%
as_tibble(rownames = ".variable") %>%
separate(.variable, c(".variable", "S", "G"), sep="[\\[,\\]]") %>%
mutate(S = S %>% as.integer, G = G %>% as.integer) %>%
left_join(my_df) %>%
rowwise() %>%
mutate(`ppc` = `read count` %>% between(`2.5%`, `97.5%`)) %>%
group_by(symbol) %>%
nest %>%
mutate(plot = map2(data, symbol, ~
{
ggplot(data = .x, aes(y=`read count`, x=sample)) +
geom_errorbar(aes(ymin=`2.5%`, ymax=`97.5%`, color =ppc)) +
my_theme
} %>%
{
if(parse_formula(formula)[1] %>% is.null %>% `!`) (.) + geom_point(aes(fill=parse_formula(formula)[1]))
(.) + geom_point(shape=21, fill="black")
}
)) %>%
mutate(
`ppc samples failed` = map_int(data, ~ .x %>% pull(ppc) %>% `!` %>% sum)
)
x
x %>% filter(symbol=="SLC35D1")
x %>% filter(symbol=="SLC35D1") %>% pull(plot)
fit %>%
summary("counts_rng") %$%
summary %>%
as_tibble(rownames = ".variable") %>%
separate(.variable, c(".variable", "S", "G"), sep="[\\[,\\]]") %>%
mutate(S = S %>% as.integer, G = G %>% as.integer) %>%
left_join(my_df) %>%
rowwise() %>%
mutate(`ppc` = `read count` %>% between(`2.5%`, `97.5%`)) %>%
group_by(symbol) %>%
nest %>%
mutate(plot = map2(data, symbol, ~
{
ggplot(data = .x, aes(y=`read count`, x=sample)) +
geom_errorbar(aes(ymin=`2.5%`, ymax=`97.5%`, color =ppc)) +
my_theme
} %>%
{
if(parse_formula(formula)[1] %>% is.null %>% `!`) (.) + geom_point(aes(fill=parse_formula(formula)[1]))
(.) + geom_point(shape=21, fill="black")
}
)) %>%
mutate(
`ppc samples failed` = map_int(data, ~ .x %>% pull(ppc) %>% `!` %>% sum)
) %>%
rename(symbol := !!gene_column)
# Return
input.df %>%
left_join(
fit %>%
summary("counts_rng") %$%
summary %>%
as_tibble(rownames = ".variable") %>%
separate(.variable, c(".variable", "S", "G"), sep="[\\[,\\]]") %>%
mutate(S = S %>% as.integer, G = G %>% as.integer) %>%
left_join(my_df) %>%
rowwise() %>%
mutate(`ppc` = `read count` %>% between(`2.5%`, `97.5%`)) %>%
group_by(symbol) %>%
nest %>%
mutate(plot = map2(data, symbol, ~
{
ggplot(data = .x, aes(y=`read count`, x=sample)) +
geom_errorbar(aes(ymin=`2.5%`, ymax=`97.5%`, color =ppc)) +
my_theme
} %>%
{
if(parse_formula(formula)[1] %>% is.null %>% `!`) (.) + geom_point(aes(fill=parse_formula(formula)[1]))
(.) + geom_point(shape=21, fill="black")
}
)) %>%
mutate(
`ppc samples failed` = map_int(data, ~ .x %>% pull(ppc) %>% `!` %>% sum)
) %>%
rename(symbol := !!gene_column)
)
source('/stornext/Bioinf/data/bioinf-data/Papenfuss_lab/projects/mangiola.s/PostDoc/ppcSeq/R/ppcSeq.R', echo=TRUE)
tidyTranscriptomics::counts %>%
inner_join( (.) %>% distinct(symbol) %>% sample_n(300)) %>%
rename(ct = `Cell type`) %>% pcc_seq()
library(ppcSeq)
library(ppcSeq)
tidyTranscriptomics::counts %>%
inner_join( (.) %>% distinct(symbol) %>% sample_n(300)) %>%
rename(ct = `Cell type`) %>% pcc_seq()
library(ppcSeq)
tidyTranscriptomics::counts %>%
inner_join( (.) %>% distinct(symbol) %>% sample_n(300)) %>%
rename(ct = `Cell type`) %>% pcc_seq()
library(ppcSeq)
tidyTranscriptomics::counts %>%
inner_join( (.) %>% distinct(symbol) %>% sample_n(300)) %>%
rename(ct = `Cell type`) %>% pcc_seq()
library(tidyverse)
tidyTranscriptomics::counts %>%
inner_join( (.) %>% distinct(symbol) %>% sample_n(300)) %>%
rename(ct = `Cell type`) %>% pcc_seq()
library(ppcSeq)
tidyTranscriptomics::counts %>%
inner_join( (.) %>% distinct(symbol) %>% sample_n(300)) %>%
rename(ct = `Cell type`) %>% pcc_seq()
library(tidyverse)
tidyTranscriptomics::counts %>%
inner_join( (.) %>% distinct(symbol) %>% sample_n(300)) %>%
rename(ct = `Cell type`) %>% pcc_seq()
